AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31
Description: 'Serverless lambda using a pandoc lambda layer to convert .docx documents
  into .pdf

  This lambda requires a pandoc biniary as a lambda layer

  '
Resources:
  HelloWorldFunction:
    Type: AWS::Serverless::Function
    Properties:
      Handler: src/app.lambda_handler
      CodeUri: s3://toms-lambda-test/3c76e919ad1267fb3b999cfec023ffec
      Runtime: python3.7
    Policies:
    - Version: '2012-10-17'
      Statement:
      - Effect: Allow
        Action:
        - s3:GetObject
        - s3:PutObject
        Resource: arn:aws:s3:::*
  SharedLayer:
    Type: AWS::Serverless::LayerVersion
    Properties:
      LayerName: pandoc-lambda-layer
      Description: pandoc binary built to run on AWS Lambda. Built From https://github.com/ministryofjustice/pandoc-aws-lambda-binary
      ContentUri: s3://toms-lambda-test/pandoc.zip
      CompatibleRuntimes:
      - python3.7
Outputs:
  HelloWorldFunction:
    Description: Hello World Lambda Function ARN
    Value:
      Fn::GetAtt:
      - HelloWorldFunction
      - Arn
  HelloWorldFunctionIamRole:
    Description: Implicit IAM Role created for Hello World function
    Value:
      Fn::GetAtt:
      - HelloWorldFunctionRole
      - Arn
  LayerArn:
    Value:
      Ref: SharedLayer
